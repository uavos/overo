<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" >
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index, follow" />
  <meta name="keywords" content="Jumpnow, embedded, software, gumstix, beagleboard, omap, linux, overo, arduino" />
  <meta name="title" content="Minimal, quick booting Gumstix image" />
  <meta name="author" content="Administrator" />
  <meta name="description" content="Jumpnow embedded software development" />
  <meta name="generator" content="Joomla! 1.5 - Open Source Content Management" />
  <title>Minimal, quick booting Gumstix image</title>
  <link href="/templates/rhuk_milkyway/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script type="text/javascript" src="/media/system/js/mootools.js"></script>
  <script type="text/javascript" src="/media/system/js/caption.js"></script>


<link rel="stylesheet" href="/templates/system/css/system.css" type="text/css" />
<link rel="stylesheet" href="/templates/system/css/general.css" type="text/css" />
<link rel="stylesheet" href="/templates/rhuk_milkyway/css/template.css" type="text/css" />
<link rel="stylesheet" href="/templates/rhuk_milkyway/css/black.css" type="text/css" />
<link rel="stylesheet" href="/templates/rhuk_milkyway/css/black_bg.css" type="text/css" />
<!--[if lte IE 6]>
<link href="/templates/rhuk_milkyway/css/ieonly.css" rel="stylesheet" type="text/css" />
<![endif]-->

</head>
<body id="page_bg" class="color_black bg_black width_fmax">
<a name="up" id="up"></a>
<div class="center" align="center">
	<div id="wrapper">
		<div id="wrapper_r">
			<div id="header">
				<div id="header_l">
					<div id="header_r">
						<div id="logo"></div>
						
					</div>
				</div>
			</div>

			<div id="tabarea">
				<div id="tabarea_l">
					<div id="tabarea_r">
						<div id="tabmenu">
						<table cellpadding="0" cellspacing="0" class="pill">
							<tr>
								<td class="pill_l">&nbsp;</td>
								<td class="pill_m">
								<div id="pillmenu">
									<ul id="mainlevel-nav"><li><a href="/index.php?option=com_content&amp;view=article&amp;id=72&amp;Itemid=80" class="mainlevel-nav" >Contact</a></li><li><a href="/index.php?option=com_content&amp;view=section&amp;layout=blog&amp;id=5&amp;Itemid=67" class="mainlevel-nav" id="active_menu-nav">Gumstix</a></li><li><a href="/index.php?option=com_content&amp;view=section&amp;layout=blog&amp;id=9&amp;Itemid=76" class="mainlevel-nav" >Arduino</a></li><li><a href="/index.php?option=com_content&amp;view=section&amp;layout=blog&amp;id=12&amp;Itemid=90" class="mainlevel-nav" >Maple</a></li><li><a href="/index.php?option=com_content&amp;view=section&amp;layout=blog&amp;id=8&amp;Itemid=69" class="mainlevel-nav" >Beagleboard</a></li><li><a href="/index.php?option=com_content&amp;view=section&amp;layout=blog&amp;id=6&amp;Itemid=64" class="mainlevel-nav" >Projects/Code</a></li><li><a href="/index.php?option=com_weblinks&amp;view=category&amp;id=19&amp;Itemid=88" class="mainlevel-nav" >Resources</a></li></ul>
								</div>
								</td>
								<td class="pill_r">&nbsp;</td>
							</tr>
							</table>
						</div>
					</div>
				</div>
			</div>

			<div id="search">
				
			</div>

			<div id="pathway">
				<span class="breadcrumbs pathway">
<a href="http://www.jumpnowtek.com/" class="pathway">Home</a> <img src="/templates/rhuk_milkyway/images/arrow.png" alt=""  /> <a href="/index.php?option=com_content&amp;view=section&amp;layout=blog&amp;id=5&amp;Itemid=67" class="pathway">Gumstix</a> <img src="/templates/rhuk_milkyway/images/arrow.png" alt=""  /> <a href="/index.php?view=category&amp;id=35%3Agumstix&amp;option=com_content&amp;Itemid=67" class="pathway">Gumstix</a> <img src="/templates/rhuk_milkyway/images/arrow.png" alt=""  /> Minimal, quick booting Gumstix image</span>

			</div>

			<div class="clr"></div>

			<div id="whitebox">
				<div id="whitebox_t">
					<div id="whitebox_tl">
						<div id="whitebox_tr"></div>
					</div>
				</div>

				<div id="whitebox_m">
					<div id="area">
									

						<div id="leftcolumn">
															<div class="module_menu">
			<div>
				<div>
					<div>
													<h3>Popular</h3>
											<ul class="menu"><li class="item1"><a href="http://www.jumpnowtek.com/"><span>Home</span></a></li><li class="item54"><a href="/index.php?option=com_content&amp;view=article&amp;id=46&amp;Itemid=54"><span>Gumstix kernel dev</span></a></li><li class="item61"><a href="/index.php?option=com_content&amp;view=article&amp;id=55&amp;Itemid=61"><span>Gumstix u-boot dev</span></a></li><li class="item78"><a href="/index.php?option=com_content&amp;view=article&amp;id=69&amp;Itemid=78"><span>Gumstix I2C</span></a></li><li class="item60"><a href="/index.php?option=com_content&amp;view=article&amp;id=54&amp;Itemid=60"><span>Gumstix GPIO</span></a></li><li class="item63"><a href="/index.php?option=com_content&amp;view=article&amp;id=56&amp;Itemid=63"><span>Gumstix PWM</span></a></li><li class="item55"><a href="/index.php?option=com_content&amp;view=article&amp;id=48&amp;Itemid=55"><span>Gumstix network boot</span></a></li><li class="item65"><a href="/index.php?option=com_content&amp;view=article&amp;id=53&amp;Itemid=65"><span>Gumstix USB networking</span></a></li><li class="item62"><a href="/index.php?option=com_content&amp;view=article&amp;id=57&amp;Itemid=62"><span>Writing a Linux SPI driver</span></a></li><li class="item89"><a href="/index.php?option=com_content&amp;view=article&amp;id=70&amp;Itemid=89"><span>Gumstix developer tips</span></a></li></ul>					</div>
				</div>
			</div>
		</div>
	
												</div>

												<div id="maincolumn">
													
							<table class="nopad">
								<tr valign="top">
									<td>
										
<div id="page">



<h2 class="contentheading">
	Minimal, quick booting Gumstix image</h2>

<p class="articleinfo">
		<span class="modifydate">
		Last Updated on Friday, 01 April 2011 17:10	</span>
	
	
	</p>


<p class="buttonheading">
	</p>





<p>I have been working with a configuration for the Gumstix Overos that can boot into Linux in under 10 seconds from power-on.</p>

<p> </p>
<p>At least half of the 10 second boot time is spent in u-boot loading and uncompressing the Linux kernel. There are changes coming to u-boot's MMC driver by Gumstix and U-Boot developers that should improve this.</p>
<p>The changes documented here are focused more on creating a smaller kernel with fewer drivers and removing some userland processes that normally run at startup with standard gumstix images. As a side effect, the smaller kernel size does help with the u-boot load/uncompress time.</p>
<p>We use systems configured similar to the one described here in some of the work I do for Fluid Imaging Technologies.</p>
<p>The project repository can be found on Github <a href="http://github.com/scottellis/overo-oe/tree/minimal">http://github.com/scottellis/overo-oe/tree/minimal</a></p>
<p>The repository is a clone of the overo branch of the gumstix-oe/mainline repository hosted here <a href="http://gitorious.org/gumstix-oe/mainline">http://gitorious.org/gumstix-oe/mainline</a>.</p>
<p>There are several branches in my repository. The overo branch is unmodified from Gitorious and could be used by anyone if gitorious.org is having problems. I'll be keeping it relatively current.</p>
<p>The branch I'm playing with for the faster booting kernels is called 'minimal'. The kernel used is 2.6.34.</p>
<p>The kernel config is slimmed down from the Overo default.</p>
<ul>
<li>No display drivers (no dss) or touchscreens</li>
<li>No wireless, bluetooth or wifi</li>
<li>smsc911x (Tobi NIC) built in</li>
<li>omap2_mcspi (SPI), g_ether (usb-net) and g_serial (usb-serial) as modules</li>
</ul>
<p>I have the recipe/linux/linux-omap3_2.6.34.bb set to default the kernel configuration for the MUSB to be a peripheral. I never use the OTG port as a host.</p>
<p>The kernel supports network booting.</p>
<p>The kernel config can be found in recipes/linux/linux-omap3-2.6.34/overo/defconfig.</p>
<p>There is a patch for board-overo.c to stop it from mucking with GPIO 144/145 even if there is no display stuff in the kernel. The recipes/linux/linux-omap3_2.6.34.bb recipe uses it. I pushed a patch like this to the Gumstix maintainers and it looks like something similar to it will now be in later Overo kernel board files and this patch won't be needed.</p>
<p>Userland is also very minimal. I use an image I call work-image.bb, which is based on the stock OE minimal-image.bb. It adds the kernel module packages above and also ssh, devmem2, tcpdump and iperf. I install my own device drivers and userland programs afterwards.</p>
<p>I also made some changes to a few recipes to remove unnecessary dependencies and which also cut down on the build time particularly when rebuilding a fresh OETMP.</p>
<p>You can look at the git log, but here's a summary</p>
<ul>
<li>openssh - removed libpam and xauth dependencies</li>
<li>libxml2 - removed python dependency</li>
<li>libpcap (tcpdump) - removed the bluez (bluetooth) dependency which brings in X</li>
</ul>
<p>Eliminating X from console image builds is finally accomplished!!!</p>
<p> </p>
<p>So if you aren't used to git, here's how you might use that Github repository.</p>
<pre>cd ${OVEROTOP}/org.openembedded.dev<br />git remote add -f se-overo-oe git://github.com/scottellis/overo-oe.git<br />git checkout -b minimal se-overo-oe/minimal<br />git branch -a<br />* minimal<br />org.openembedded.dev<br />overo<br />remotes/origin/HEAD -&gt; origin/org.openembedded.dev<br />remotes/origin/org.openembedded.dev<br />remotes/origin/overo<br />remotes/se-overo-oe/minimal<br /><br />cd ${OVEROTOP}<br />bitbake -c clean virtual/kernel; bitbake virtual/kernel; bitbake work-image<br /></pre>
<p>When you want to go back to the normal Gumstix OE branch run</p>
<pre>cd ${OVEROTOP}/org.openembedded.dev<br />checkout overo<br /></pre>
<p>And here's a sample boot log of the image running - <a href="/docs/gumstix/minimal/boot-log.txt">boot-log.txt</a></p>
<p>I also remove a few of the init.d scripts as part of my rootfs copying scripts. If you are interested in speed, the important script to remove is udev. The systems I work on are pretty static when it comes to devices so udev is unnecessary.  Here's the script I use for reference <a href="/docs/gumstix/minimal/fix-minimal-startup-scripts-sh.txt">fix-minimal-startup-scripts.sh</a>.</p>
<p>My next experiment will be to completely remove the userland udev programs from the images or at least make some serious mods to the udev scripts.</p>
<p>Chris Whittenburg at <a href="http://www.sleepyrobot.com">sleepyrobot.com</a> has an article for using busybox's mdev - <a href="http://www.sleepyrobot.com/?p=83">Alternative to udev in openembedded/Angstrom</a></p>
<p>If you really care about boot times, don't forget to modify the u-boot bootdelay variable.</p>
<p> </p>
<p>Update - 28Feb2011</p>
<p>I added another branch for a minimal image based on the latest 2.6.36r97 gumstix kernel. You can download prebuilt files here - <a href="/Downloads/minimal-2.6.36r97/">Downloads/minimal-2.6.36r97/</a>. All the pieces are there, MLO, u-boot, uImage and rootfs. Install it the way you normally would, SD card, Nand or NFS.</p>
<p>The source for the build can be found here <a href="https://github.com/scottellis/overo-oe/tree/minimal-2.6.36">github.com/scottellis/overo-oe/tree/minimal-2.6.36</a>.</p>
<p> </p>

</div>

										
									</td>
																	</tr>
							</table>

						</div>
						<div class="clr"></div>
					</div>
					<div class="clr"></div>
				</div>

				<div id="whitebox_b">
					<div id="whitebox_bl">
						<div id="whitebox_br"></div>
					</div>
				</div>
			</div>

			<div id="footerspacer"></div>
		</div>

		<div id="footer">
			<div id="footer_l">
				<div id="footer_r">
					<p id="syndicate">
						
					</p>
<!--
					<p id="power_by">
	 				 	Powered by <a href="http://www.joomla.org">Joomla!</a>.
						valid <a href="http://validator.w3.org/check/referer">XHTML</a> and <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a>.
					</p>
-->
				</div>
			</div>
		</div>
	</div>
</div>


</body>
</html>
